<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Gajago-dashboard-deals by leisureq</title>

        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700">
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
        <link rel="stylesheet" type="text/css" href="../stylesheets/stylesheet.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../stylesheets/v2.css" media="screen">

        <!-- custom -->
        <style type="text/css">
            html,body { height:100%; }
            * { -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                -webkit-overflow-scrolling: touch;
            }
            .ellipsis { text-overflow: ellipsis; white-space: nowrap; overflow: hidden; }

            ul {list-style: none;}
            ul,li { padding: 0; margin: 0}
            a:hover, a:active { text-decoration:none }
            ul.LBox		{ padding:0; border:0;}
            .LBox:after	{ content:" "; display:block; clear:both;}
            .LBox > li	{ float:left; padding:0; border:0;}
            .LBox > li.li_R	{ float:right; }
            .none { display:none }

            /*tab*/
            .menu-tab { margin-bottom: -1px }
            .menu-tab li {
                display: block;
                width:50%;
                padding: 0.8em 0;
                box-sizing: content-box;
                background-color:#FFF;
            }
            .menu-tab li.active { border-bottom:4px solid #1F93FF; color: #1F93FF;}
            .menu-tab a {
                display: block;
                width: 100%;
                text-align: center; border-bottom:#1F93FF;
            }

            /*layout*/
            .herder {
                padding: 0; margin: 0;
                text-align: center;
                background-color:#FFF;
            }
            .herder-title { margin: 0; padding:0.2em;    font-size:1.5em; color:#FFF; text-align: left; background:#1F93FF }

            /*filter-box ui*/
            .menu { display:table;    width:100%; height:100%;    margin: 0 auto; text-align: left; border-bottom:1px solid #D8D8D8; }
            .menu > li { display:table-cell; padding: 0; margin: 0; text-align: center; }
            .menu a { display: block; padding: 1em 0; }
            .filter-box-msg {    margin-top:-2px; padding:0.8em 0;    color:#FFF;     text-align: center; background:#9F9F9F }
            .depth1menu {
                width:40%;
                padding: 0.5em 0.1em;
                border-right:1px solid #D8D8D8;
            }
            .depth1menu a { color:#469FFF }
            .depth1menu .active a { color:#FFF;    background-color:#1F93FF }
            .depth2menu {
                width:60%;
                background: #F2F2F2;
            }
            .depth2menu li { padding: 0 1.5em; text-align: left }
            .depth2menu a {
                color: #8A8A8A;
                border-bottom:1px solid #D0D0D0 ;
            }
            .depth2menu li:hover,.depth2menu li:active {
                background: #DFDFDF;
            }
            .depth2menu li:hover a,.depth2menu li:active a {    color: #000}


                /*map */
            .map_wrap {position:relative;overflow:hidden;width:98%; margin:0 }
            .radius_border{border:1px solid #919191;border-radius:5px;}
            .custom_typecontrol {position:absolute;top:10px;right:10px;overflow:hidden;width:130px;height:30px;margin:0;padding:0;z-index:1;font-size:12px;font-family:'Malgun Gothic', '맑은 고딕', sans-serif;box-sizing:content-box;}
            .custom_typecontrol span {display:block;width:65px;height:30px;float:left;text-align:center;line-height:30px;cursor:pointer;}
            .custom_typecontrol .map-btn {background:#fff;background:linear-gradient(#fff,    #e6e6e6);}
            .custom_typecontrol .map-btn:hover {background:#f5f5f5;background:linear-gradient(#f5f5f5,#e3e3e3);}
            .custom_typecontrol .map-btn:active {background:#e6e6e6;background:linear-gradient(#e6e6e6, #fff);}
            .custom_typecontrol .selected-btn {color:#fff;background:#425470;background:linear-gradient(#425470, #5b6d8a);}
            .custom_typecontrol .selected-btn:hover {color:#fff;}
            .custom_zoomcontrol {position:absolute;top:50px;right:10px;width:36px;height:80px;overflow:hidden;z-index:1;background-color:#f5f5f5;}
            .custom_zoomcontrol span {display:block;width:36px;height:40px;text-align:center;cursor:pointer;}
            .custom_zoomcontrol span img {width:15px;height:15px;padding:12px 0;border:none;box-sizing:content-box;}
            .custom_zoomcontrol span:first-child{border-bottom:1px solid #bfbfbf;}
        </style>
    </head>
    <body>
    <div id="board-container">
        <header class="herder">
            <h1 class="herder-title">Gajago 딜 현황판</h1>
            <nav>
                <ul class="LBox menu-tab">
                    <li class="active"><a data-href="area">지역</a></li>
                    <li><a data-href="myarea">내주변</a></li>
                </ul>
            </nav>
        </header>

        <div class="content">
            <section class="filter-box" id="filter-view"></section>
            <section class="map-box"    id="map-view"></section>
            <section class="deal-box"   id="list-view"></section>
        </div>

        <footer class="site-footer"></footer>
    </div>
    <button id="btn-show-list" class="none"></button>
    <button id="btn-show-map" class="none"></button>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/2.2.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/lodash/4.11.1/lodash.min.js"></script>
    <script type="text/javascript" src="https://apis.daum.net/maps/maps3.js?apikey=362020f21637d2827594370aa32c3ee4&libraries=services,clusterer"></script>
    <script type="text/javascript" src="./filter-view.js"></script>
    <script type="text/javascript" src="./list-view.js"></script>
    <script type="text/javascript" src="./map-view.js"></script>
    <script type="text/javascript" src="./spin.js"></script>

    <script type="text/javascript">
        var _spinner = (function(){
            var target = document.getElementById('board-container');
            var spinner = new Spinner({
                lines: 9 // The number of lines to draw
                , length: 42 // The length of each line
                , width: 18 // The line thickness
                , radius: 57 // The radius of the inner circle
                , scale: 1.25 // Scales overall size of the spinner
                , corners: 0.8 // Corner roundness (0..1)
                , color: '#000' // #rgb or #rrggbb or array of colors
                , opacity: 0.1 // Opacity of the lines
                , rotate: 0 // The rotation offset
                , direction: 1 // 1: clockwise, -1: counterclockwise
                , speed: 0.8 // Rounds per second
                , trail: 50 // Afterglow percentage
                , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
                , zIndex: 2e9 // The z-index (defaults to 2000000000)
                , className: 'spinner' // The CSS class to assign to the spinner
                , top: '50%' // Top position relative to parent
                , left: '50%' // Left position relative to parent
                , shadow: true // Whether to render a shadow
                , hwaccel: true // Whether to use hardware acceleration
                , position: 'absolute' // Element positioning
            });

            return {
                spin: function(){
                    spinner.spin(target);
                },
                stop: function(){
                    spinner.stop();
                }
            };
        })();

        /**@@@ tab @@@@@@@@@@@@@@@@@@@*/
        var _listView = new ListView($('#list-view'), {
            init: {
                display: false
            },
            event: {
                afterShow: function(e) {
                    $('#btn-show-map').show();
                    $('#btn-show-list').hide();
                }
            }
        });
        var _mapView = new MapView($('#map-view'), {
            init: {
                display: false
            },
            event: {
                afterShow: function(e) {
                    $('#btn-show-list').show();
                    $('#btn-show-map').hide();
                }
            }
        });
        var _filterView = new FilterView($('#filter-view'), {
            init: {
                display: true
            },
            event: {
                select: function(e){
                    _spinner.spin();
                    var code = $(e.target).attr('data-href');
                    $.get('https://alpha-www.thegajago.com/map/region/'+code, function(deals){
                        _cachedDealResponse = deals;
                        _listView.render(_cachedDealResponse);
                        _filterView.display(false);
                        _spinner.stop();
                    });
                }
            }
        });
        var _cachedDealResponse = {};

        $('.menu-tab a').bind("click",function(e){
            _cachedDealResponse = {}; // cache clear

            $('.menu-tab li').removeClass('active');
            $(this).parent().addClass('active');

            if ($(this).attr('data-href') == "area") {
                //지역
                _filterView.display(true);
                _listView.display(false);
                _mapView.display(false);
            } else {
                //내주변
                _filterView.display(false);
                _listView.display(false);
                _mapView.display(true);
                _spinner.spin();
                _mapView.getCurrentPosition(loadMyAreaDeals);
            }
            e.preventDefault();
        });

        //지도로 보기
        $('#btn-show-list').click(function(e){
            e.preventDefault();
            _mapView.display(false);
            _listView.render(_cachedDealResponse);
        });

        //목록 보기
        $('#btn-show-map').click(function(e){
            e.preventDefault();
            _listView.display(false);
            _mapView.render(_cachedDealResponse);
        });

        /**@@@ 내주변    @@@@@@@@@@@@@@@@@@@*/
        function loadMyAreaDeals(position) {
            if (!position) return;

            var params = { lat: position.coords.latitude, lon: position.coords.longitude };
            $.get('https://alpha-www.thegajago.com/map/deals', params, function(deals){
                _cachedDealResponse = {
                    list: deals,
                    centerLat: position.coords.latitude,
                    centerLon: position.coords.longitude
                }
                _listView.display(false);
                _mapView.render(_cachedDealResponse);
                _spinner.stop();
            });
        }

        //event
    </script>
    </body>
</html>
